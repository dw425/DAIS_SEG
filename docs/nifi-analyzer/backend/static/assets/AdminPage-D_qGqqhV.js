import{r as a,u as k,j as e,a as _}from"./index-tIH9TuVJ.js";import{i as L}from"./AdminConsole-BUVybbMM.js";function P(){const[o,u]=a.useState([]),[r,y]=a.useState(0),[m,d]=a.useState(!1),[i,f]=a.useState(""),[c,j]=a.useState(""),[l,p]=a.useState(0),x=25,N=k(s=>s.token),g=async()=>{d(!0),f("");try{const s=new URLSearchParams({limit:String(x),offset:String(l)});c&&s.set("action",c);const h=await fetch(`/api/audit?${s}`,{headers:{Authorization:`Bearer ${N}`}});if(!h.ok)throw new Error(`Failed to load audit logs (${h.status})`);const b=await h.json();u(b.logs),y(b.total)}catch(s){f(s.message)}finally{d(!1)}};return a.useEffect(()=>{g()},[l,c]),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-300",children:"Audit Trail"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"Filter by action...",value:c,onChange:s=>{j(s.target.value),p(0)},className:`px-3 py-1.5 bg-gray-800 border border-gray-700 rounded-lg text-gray-200 text-xs
              placeholder-gray-500 focus:outline-none focus:border-primary transition w-48`}),e.jsx("button",{onClick:g,className:"px-3 py-1.5 rounded-lg bg-gray-800 text-gray-300 text-xs hover:bg-gray-700 transition",children:"Refresh"})]})]}),i&&e.jsx("div",{className:"p-3 rounded-lg bg-red-500/10 border border-red-500/30 text-red-400 text-sm",children:i}),m?e.jsx("div",{className:"text-center py-8 text-gray-500 text-sm",children:"Loading audit logs..."}):e.jsx("div",{className:"overflow-x-auto rounded-lg border border-gray-800",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-900/80 border-b border-gray-800",children:[e.jsx("th",{className:"text-left px-4 py-2.5 text-xs font-medium text-gray-400 uppercase",children:"Time"}),e.jsx("th",{className:"text-left px-4 py-2.5 text-xs font-medium text-gray-400 uppercase",children:"Action"}),e.jsx("th",{className:"text-left px-4 py-2.5 text-xs font-medium text-gray-400 uppercase",children:"Resource"}),e.jsx("th",{className:"text-left px-4 py-2.5 text-xs font-medium text-gray-400 uppercase",children:"IP"}),e.jsx("th",{className:"text-left px-4 py-2.5 text-xs font-medium text-gray-400 uppercase",children:"Status"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-800",children:[o.map(s=>e.jsxs("tr",{className:"hover:bg-gray-800/50 transition",children:[e.jsx("td",{className:"px-4 py-2.5 text-xs text-gray-400 whitespace-nowrap",children:s.created_at?new Date(s.created_at).toLocaleString():"-"}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-gray-200 font-mono",children:s.action}),e.jsxs("td",{className:"px-4 py-2.5 text-xs text-gray-400",children:[s.resource_type||"-",s.resource_id?` / ${s.resource_id.slice(0,8)}...`:""]}),e.jsx("td",{className:"px-4 py-2.5 text-xs text-gray-500",children:s.ip_address||"-"}),e.jsx("td",{className:"px-4 py-2.5 text-xs",children:s.details&&typeof s.details=="object"&&"status_code"in s.details?e.jsx("span",{className:`px-1.5 py-0.5 rounded ${s.details.status_code<400?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"}`,children:String(s.details.status_code)}):"-"})]},s.id)),o.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-8 text-center text-gray-500 text-sm",children:"No audit logs found"})})]})]})}),r>x&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:["Showing ",l+1,"-",Math.min(l+x,r)," of ",r]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>p(Math.max(0,l-x)),disabled:l===0,className:"px-3 py-1 rounded bg-gray-800 text-xs text-gray-300 hover:bg-gray-700 disabled:opacity-40 transition",children:"Previous"}),e.jsx("button",{onClick:()=>p(l+x),disabled:l+x>=r,className:"px-3 py-1 rounded bg-gray-800 text-xs text-gray-300 hover:bg-gray-700 disabled:opacity-40 transition",children:"Next"})]})]})]})}function I(){const[o,u]=a.useState([]),[r,y]=a.useState(!1),[m,d]=a.useState(""),[i,f]=a.useState(!1),[c,j]=a.useState(""),[l,p]=a.useState("read"),[x,N]=a.useState(null),[g,s]=a.useState(null),[h,b]=a.useState(!1),v={Authorization:`Bearer ${k(t=>t.token)}`,"Content-Type":"application/json"},w=async()=>{y(!0),d("");try{const t=await fetch("/api/api-keys",{headers:v});if(!t.ok)throw new Error(`Failed to load API keys (${t.status})`);const n=await t.json();u(n.api_keys)}catch(t){d(t.message)}finally{y(!1)}};a.useEffect(()=>{w()},[]);const S=async t=>{if(t.preventDefault(),!!c.trim()){b(!0),d("");try{const n=await fetch("/api/api-keys",{method:"POST",headers:v,body:JSON.stringify({name:c.trim(),scopes:l,expires_in_days:x})});if(!n.ok)throw new Error(`Failed to create API key (${n.status})`);const A=await n.json();s(A.api_key.key),j(""),p("read"),N(null),w()}catch(n){d(n.message)}finally{b(!1)}}},C=async t=>{if(window.confirm("Revoke this API key? It will stop working immediately."))try{const n=await fetch(`/api/api-keys/${t}`,{method:"DELETE",headers:v});if(!n.ok)throw new Error(`Failed to revoke key (${n.status})`);w()}catch(n){d(n.message)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-300",children:"API Keys"}),e.jsx("button",{onClick:()=>{f(!i),s(null)},className:"px-3 py-1.5 rounded-lg bg-primary/10 text-primary text-xs font-medium hover:bg-primary/20 transition",children:i?"Cancel":"Generate Key"})]}),m&&e.jsx("div",{className:"p-3 rounded-lg bg-red-500/10 border border-red-500/30 text-red-400 text-sm",children:m}),g&&e.jsxs("div",{className:"p-4 rounded-lg bg-green-500/10 border border-green-500/30",children:[e.jsx("p",{className:"text-sm text-green-400 font-medium mb-2",children:"API key created! Copy it now -- it will not be shown again."}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"flex-1 px-3 py-2 bg-gray-800 rounded text-xs text-gray-200 font-mono break-all",children:g}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(g)},className:"px-3 py-2 rounded bg-gray-700 text-xs text-gray-300 hover:bg-gray-600 transition shrink-0",children:"Copy"})]})]}),i&&e.jsxs("form",{onSubmit:S,className:"p-4 rounded-lg bg-gray-800/50 border border-gray-700 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-300 mb-1",children:"Key name"}),e.jsx("input",{type:"text",value:c,onChange:t=>j(t.target.value),placeholder:"e.g. CI Pipeline Key",className:`w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-gray-100 text-sm
                placeholder-gray-500 focus:outline-none focus:border-primary transition`})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-300 mb-1",children:"Scopes"}),e.jsxs("select",{value:l,onChange:t=>p(t.target.value),className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-gray-100 text-sm focus:outline-none focus:border-primary transition",children:[e.jsx("option",{value:"read",children:"Read only"}),e.jsx("option",{value:"read,write",children:"Read + Write"}),e.jsx("option",{value:"read,write,delete",children:"Full access"})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-300 mb-1",children:"Expires in (days)"}),e.jsx("input",{type:"number",value:x??"",onChange:t=>N(t.target.value?parseInt(t.target.value):null),placeholder:"Never",min:1,className:`w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-gray-100 text-sm
                  placeholder-gray-500 focus:outline-none focus:border-primary transition`})]})]}),e.jsx("button",{type:"submit",disabled:h||!c.trim(),className:"px-4 py-2 bg-primary hover:bg-primary/90 disabled:opacity-50 text-white font-medium rounded-lg text-sm transition",children:h?"Creating...":"Generate"})]}),r?e.jsx("div",{className:"text-center py-8 text-gray-500 text-sm",children:"Loading API keys..."}):e.jsx("div",{className:"overflow-x-auto rounded-lg border border-gray-800",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-900/80 border-b border-gray-800",children:[e.jsx("th",{className:"text-left px-4 py-2.5 text-xs font-medium text-gray-400 uppercase",children:"Name"}),e.jsx("th",{className:"text-left px-4 py-2.5 text-xs font-medium text-gray-400 uppercase",children:"Prefix"}),e.jsx("th",{className:"text-left px-4 py-2.5 text-xs font-medium text-gray-400 uppercase",children:"Scopes"}),e.jsx("th",{className:"text-left px-4 py-2.5 text-xs font-medium text-gray-400 uppercase",children:"Status"}),e.jsx("th",{className:"text-left px-4 py-2.5 text-xs font-medium text-gray-400 uppercase",children:"Last used"}),e.jsx("th",{className:"text-left px-4 py-2.5 text-xs font-medium text-gray-400 uppercase",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-800",children:[o.map(t=>e.jsxs("tr",{className:"hover:bg-gray-800/50 transition",children:[e.jsx("td",{className:"px-4 py-2.5 text-gray-200",children:t.name}),e.jsxs("td",{className:"px-4 py-2.5 text-gray-400 font-mono text-xs",children:[t.prefix,"..."]}),e.jsx("td",{className:"px-4 py-2.5 text-gray-400 text-xs",children:t.scopes}),e.jsx("td",{className:"px-4 py-2.5",children:e.jsx("span",{className:`px-1.5 py-0.5 rounded text-xs ${t.is_active?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"}`,children:t.is_active?"Active":"Revoked"})}),e.jsx("td",{className:"px-4 py-2.5 text-gray-500 text-xs",children:t.last_used_at?new Date(t.last_used_at).toLocaleDateString():"Never"}),e.jsx("td",{className:"px-4 py-2.5",children:t.is_active&&e.jsx("button",{onClick:()=>C(t.id),className:"px-2 py-1 rounded text-xs text-red-400 hover:bg-red-500/10 transition",children:"Revoke"})})]},t.id)),o.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-8 text-center text-gray-500 text-sm",children:"No API keys found"})})]})]})})]})}function R(){const[o,u]=a.useState("console"),{user:r,logout:y}=k(),m=_(),d=[{id:"console",label:"Console"},{id:"audit",label:"Audit Trail"},{id:"api-keys",label:"API Keys"}];return e.jsxs("div",{className:"h-screen flex flex-col bg-gray-950 text-gray-100",children:[e.jsxs("header",{className:"h-14 shrink-0 bg-gray-900/80 border-b border-gray-800 backdrop-blur-sm flex items-center px-4 gap-4 z-30",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-primary/20 flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-primary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})})}),e.jsx("h1",{className:"text-base font-semibold text-gray-100",children:"Admin"})]}),e.jsx("div",{className:"flex-1"}),e.jsx("button",{onClick:()=>m("/dashboard"),className:"px-3 py-1.5 rounded-lg text-sm text-gray-400 hover:text-gray-200 hover:bg-gray-800 transition",children:"Dashboard"}),e.jsx("button",{onClick:()=>m("/pipeline"),className:"px-3 py-1.5 rounded-lg text-sm text-gray-400 hover:text-gray-200 hover:bg-gray-800 transition",children:"Pipeline"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-gray-200",children:r==null?void 0:r.name}),e.jsx("div",{className:"text-xs text-gray-500",children:r==null?void 0:r.role})]}),e.jsx("button",{onClick:()=>{y(),m("/login")},className:"p-2 rounded-lg text-gray-400 hover:text-gray-200 hover:bg-gray-800 transition",title:"Sign out",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})})]})]}),e.jsx("div",{className:"shrink-0 border-b border-gray-800 bg-gray-900/50 px-4",children:e.jsx("div",{className:"flex gap-1",children:d.map(i=>e.jsx("button",{onClick:()=>u(i.id),className:`px-4 py-2.5 text-sm font-medium border-b-2 transition
                ${o===i.id?"border-primary text-primary":"border-transparent text-gray-500 hover:text-gray-300"}`,children:i.label},i.id))})}),e.jsx("main",{className:"flex-1 overflow-y-auto p-6",children:e.jsxs("div",{className:"max-w-5xl mx-auto",children:[o==="console"&&e.jsx(L,{}),o==="audit"&&e.jsx(P,{}),o==="api-keys"&&e.jsx(I,{})]})})]})}export{R as default};
