import{c as w,u as j,j as e,r as d,a as v}from"./index-tIH9TuVJ.js";const p="/api";function y(){const t=j.getState().token;return t?{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}:{"Content-Type":"application/json"}}const k=w(t=>({projects:[],isLoading:!1,error:null,fetchProjects:async()=>{t({isLoading:!0,error:null});try{const r=await fetch(`${p}/projects`,{headers:y()});if(!r.ok)throw new Error(`Failed to fetch projects (${r.status})`);const a=await r.json();t({projects:a.projects,isLoading:!1})}catch(r){t({isLoading:!1,error:r.message})}},createProject:async(r,a,s)=>{t({isLoading:!0,error:null});try{const o=await fetch(`${p}/projects`,{method:"POST",headers:y(),body:JSON.stringify({name:r,description:a,platform:s})});if(!o.ok){const l=await o.json().catch(()=>({detail:"Create failed"}));throw new Error(l.detail||`Create failed (${o.status})`)}const c=await o.json();return t(l=>({projects:[c.project,...l.projects],isLoading:!1})),c.project}catch(o){throw t({isLoading:!1,error:o.message}),o}},updateProject:async(r,a)=>{t({isLoading:!0,error:null});try{const s=await fetch(`${p}/projects/${r}`,{method:"PUT",headers:y(),body:JSON.stringify(a)});if(!s.ok)throw new Error(`Update failed (${s.status})`);const o=await s.json();t(c=>({projects:c.projects.map(l=>l.id===r?o.project:l),isLoading:!1}))}catch(s){t({isLoading:!1,error:s.message})}},deleteProject:async r=>{t({isLoading:!0,error:null});try{const a=await fetch(`${p}/projects/${r}`,{method:"DELETE",headers:y()});if(!a.ok)throw new Error(`Delete failed (${a.status})`);t(s=>({projects:s.projects.filter(o=>o.id!==r),isLoading:!1}))}catch(a){t({isLoading:!1,error:a.message})}},clearError:()=>t({error:null})})),f={nifi:"bg-blue-500/20 text-blue-400",ssis:"bg-purple-500/20 text-purple-400",airflow:"bg-green-500/20 text-green-400",dbt:"bg-orange-500/20 text-orange-400",adf:"bg-cyan-500/20 text-cyan-400",glue:"bg-yellow-500/20 text-yellow-400",auto:"bg-gray-500/20 text-gray-400"};function L({project:t,onOpen:r,onDelete:a}){const s=f[t.platform]||f.auto;return e.jsxs("div",{className:"bg-gray-900 border border-gray-800 rounded-xl p-5 hover:border-gray-700 transition group",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${s}`,children:t.platform}),t.run_count>0&&e.jsxs("span",{className:"px-2 py-0.5 rounded text-xs bg-gray-800 text-gray-400",children:[t.run_count," run",t.run_count!==1?"s":""]})]}),e.jsx("button",{onClick:o=>{o.stopPropagation(),a(t.id)},className:"p-1 rounded text-gray-600 hover:text-red-400 hover:bg-red-500/10 transition opacity-0 group-hover:opacity-100",title:"Delete project",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),e.jsx("h3",{className:"text-base font-semibold text-gray-100 mb-1 truncate",children:t.name}),e.jsx("p",{className:"text-sm text-gray-400 mb-4 line-clamp-2",children:t.description||"No description"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-gray-500",children:t.updated_at?new Date(t.updated_at).toLocaleDateString():"N/A"}),e.jsx("button",{onClick:()=>r(t.id),className:"px-3 py-1.5 rounded-lg bg-primary/10 text-primary text-xs font-medium hover:bg-primary/20 transition",children:"Open Pipeline"})]})]})}const C=[{id:"auto",label:"Auto-detect"},{id:"nifi",label:"Apache NiFi"},{id:"ssis",label:"SQL Server SSIS"},{id:"airflow",label:"Apache Airflow"},{id:"dbt",label:"dbt"},{id:"adf",label:"Azure Data Factory"},{id:"glue",label:"AWS Glue"},{id:"talend",label:"Talend"},{id:"informatica",label:"Informatica"},{id:"sql",label:"Generic SQL"}];function S({isOpen:t,onClose:r,onSubmit:a}){const[s,o]=d.useState(""),[c,l]=d.useState(""),[m,x]=d.useState("auto"),[g,u]=d.useState(!1),[h,i]=d.useState("");if(!t)return null;const b=async n=>{if(n.preventDefault(),!s.trim()){i("Project name is required");return}u(!0),i("");try{await a(s.trim(),c.trim(),m),o(""),l(""),x("auto"),r()}catch(N){i(N.message)}finally{u(!1)}};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:r}),e.jsxs("div",{className:"relative bg-gray-900 border border-gray-800 rounded-2xl p-6 w-full max-w-lg shadow-2xl",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-100 mb-4",children:"Create New Project"}),h&&e.jsx("div",{className:"mb-4 p-3 rounded-lg bg-red-500/10 border border-red-500/30 text-red-400 text-sm",children:h}),e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1.5",children:"Project name"}),e.jsx("input",{type:"text",value:s,onChange:n=>o(n.target.value),className:`w-full px-3 py-2.5 bg-gray-800 border border-gray-700 rounded-lg text-gray-100 text-sm
                placeholder-gray-500 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition`,placeholder:"My NiFi Migration",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1.5",children:"Description"}),e.jsx("textarea",{value:c,onChange:n=>l(n.target.value),rows:3,className:`w-full px-3 py-2.5 bg-gray-800 border border-gray-700 rounded-lg text-gray-100 text-sm
                placeholder-gray-500 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition resize-none`,placeholder:"Brief description of the migration project..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1.5",children:"Source platform"}),e.jsx("select",{value:m,onChange:n=>x(n.target.value),className:`w-full px-3 py-2.5 bg-gray-800 border border-gray-700 rounded-lg text-gray-100 text-sm
                focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition`,children:C.map(n=>e.jsx("option",{value:n.id,children:n.label},n.id))})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 rounded-lg text-sm text-gray-400 hover:text-gray-200 hover:bg-gray-800 transition",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:g,className:"px-4 py-2 bg-primary hover:bg-primary/90 disabled:opacity-50 text-white font-medium rounded-lg text-sm transition",children:g?"Creating...":"Create Project"})]})]})]})]})}function P(){const{projects:t,isLoading:r,error:a,fetchProjects:s,createProject:o,deleteProject:c}=k(),[l,m]=d.useState(!1),x=v();d.useEffect(()=>{s()},[s]);const g=i=>{x(`/pipeline?project=${i}`)},u=async i=>{window.confirm("Delete this project and all its runs? This cannot be undone.")&&await c(i)},h=async(i,b,n)=>{await o(i,b,n)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-100",children:"Projects"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Manage your ETL migration projects"})]}),e.jsxs("button",{onClick:()=>m(!0),className:"px-4 py-2 bg-primary hover:bg-primary/90 text-white font-medium rounded-lg text-sm transition flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"New Project"]})]}),a&&e.jsx("div",{className:"p-3 rounded-lg bg-red-500/10 border border-red-500/30 text-red-400 text-sm",children:a}),r&&t.length===0&&e.jsx("div",{className:"text-center py-12 text-gray-500",children:"Loading projects..."}),!r&&t.length===0&&e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-gray-800 flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})})}),e.jsx("h3",{className:"text-gray-300 font-medium mb-1",children:"No projects yet"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Create your first migration project to get started."}),e.jsx("button",{onClick:()=>m(!0),className:"px-4 py-2 bg-primary/10 text-primary rounded-lg text-sm font-medium hover:bg-primary/20 transition",children:"Create Project"})]}),t.length>0&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(i=>e.jsx(L,{project:i,onOpen:g,onDelete:u},i.id))}),e.jsx(S,{isOpen:l,onClose:()=>m(!1),onSubmit:h})]})}function E(){const{user:t,logout:r}=j(),a=v(),s=()=>{r(),a("/login")};return e.jsxs("div",{className:"h-screen flex flex-col bg-gray-950 text-gray-100",children:[e.jsxs("header",{className:"h-14 shrink-0 bg-gray-900/80 border-b border-gray-800 backdrop-blur-sm flex items-center px-4 gap-4 z-30",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-primary/20 flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-primary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})})}),e.jsx("h1",{className:"text-base font-semibold text-gray-100 hidden sm:block",children:"ETL Migration Platform"})]}),e.jsx("div",{className:"flex-1"}),e.jsx("button",{onClick:()=>a("/pipeline"),className:"px-3 py-1.5 rounded-lg text-sm text-gray-400 hover:text-gray-200 hover:bg-gray-800 transition",children:"Quick Pipeline"}),(t==null?void 0:t.role)==="admin"&&e.jsx("button",{onClick:()=>a("/admin"),className:"px-3 py-1.5 rounded-lg text-sm text-gray-400 hover:text-gray-200 hover:bg-gray-800 transition",children:"Admin"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-gray-200",children:t==null?void 0:t.name}),e.jsx("div",{className:"text-xs text-gray-500",children:t==null?void 0:t.role})]}),e.jsx("button",{onClick:s,className:"p-2 rounded-lg text-gray-400 hover:text-gray-200 hover:bg-gray-800 transition",title:"Sign out",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})})]})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-6",children:e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsx(P,{})})})]})}export{E as default};
